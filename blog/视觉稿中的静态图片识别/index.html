<!doctype html><html lang=en-us><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?9fb3cda71a61f7006356f0c75fac487d";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>视觉稿中的静态图片识别 - CocaColf</title><meta property="og:title" content="视觉稿中的静态图片识别 - CocaColf"><meta name=twitter:card content="summary"><meta property="description" content="网页上的静态图片从代码上来说，是如 &amp;lt;img src=&amp;quot;xxx&amp;quot; /&amp;gt; 这样的代码。因此在设计稿转代码时，需要知道设计稿里哪个地方是静态图片，同时将这个静态图片导出后生成对应的链接地址，这样生成的代码才能完整的运行起来看到页面效果。
我司设计师使用的设计工具是 MasterGo。和其他设计工具无异，通过各种类型的节点裁切组合来创造图形。组合方式五花八门，设计师的绘图 &amp;hellip;"><meta property="og:description" content="网页上的静态图片从代码上来说，是如 &amp;lt;img src=&amp;quot;xxx&amp;quot; /&amp;gt; 这样的代码。因此在设计稿转代码时，需要知道设计稿里哪个地方是静态图片，同时将这个静态图片导出后生成对应的链接地址，这样生成的代码才能完整的运行起来看到页面效果。
我司设计师使用的设计工具是 MasterGo。和其他设计工具无异，通过各种类型的节点裁切组合来创造图形。组合方式五花八门，设计师的绘图 &amp;hellip;"><meta name=twitter:image content="https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/mastergo_node_types.png"><link href=//cdn.bootcss.com/highlight.js/9.12.0/styles/monokai.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body class=blog><header class=masthead><h1><a href=/>CocaColf</a></h1><p class=tagline>庭前桃李满，院外小径芳</p><nav class=menu><input id=menu-check type=checkbox hidden>
<label id=menu-label for=menu-check class=unselectable hidden><span class="icon close-icon">✕</span>
<span class="icon open-icon">☰</span>
<span class=text>Menu</span></label><ul><li><a href=/tags/writing/>文字</a></li><li><a href=/tags/technical/>技术</a></li><li><a href=/about/>关于</a></li><li><a href=/tags/>标签</a></li><li><a href=/index.xml>订阅</a></li></ul></nav></header><article class=main><header class=title><h1>视觉稿中的静态图片识别</h1><h3>2023-05-24</h3><hr></header><h2 id=背景>背景</h2><p>网页上的静态图片从代码上来说，是如 <code>&lt;img src="xxx" /></code> 这样的代码。因此在设计稿转代码时，需要知道设计稿里哪个地方是静态图片，同时将这个静态图片导出后生成对应的链接地址，这样生成的代码才能完整的运行起来看到页面效果。</p><p>我司设计师使用的设计工具是 <a href=https://mastergo.com/>MasterGo</a>。和其他设计工具无异，通过各种类型的节点裁切组合来创造图形。组合方式五花八门，设计师的绘图方式也可以千奇百怪，所以从直观感受来说一个静态图片内部节点的组成情况是非常复杂的。所以这个问题本质上是给你一个设计稿页面节点数据，判断哪些节点组合起来是静态图片。</p><p>下面是 MasterGo 节点的类型和一个静态图片的节点组成的部分片段。</p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/mastergo_node_types.png alt=节点类型></p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/%E8%8A%82%E7%82%B9%E7%BB%84%E6%88%90%E7%A4%BA%E4%BE%8B.png alt=节点组成示例></p><h2 id=思考过程>思考&过程</h2><p>众多的组合方式和绘图方法，意味着输入不固定、可能性无穷多，这种不确定性很大的问题仅通过编码手段来解决是否不太可行性呢？答案是否定的。第一，这种不确定性只是自己的感觉而已，有待证明；第二，如果有个解法可以覆盖其中的绝大多数场景，那么这个解决方案也是非常够用的；第三，可以添加限制条件，使得输入减少，往确定性高的方向靠拢，解决频率最高的场景。所以解决这个问题应当先立下要求（限定），再进行归纳，再提出解法。</p><p>根据我的场景，我提出了下面两个条件或要求：</p><ol><li>静态图片里不含有文本节点。因为文本一般要做国际化，一般由开发人员编码</li><li>由于方案不一定完全准确，为了避免误判造成出码不准确和导出太多的静态文件造成困扰，导出静态图片以「宁可少导出不要误导出」为优先级原则</li></ol><p>接下来我翻看大量的设计稿，主要看其中静态图片的节点组合方式，我逐渐发现了规律。</p><p><strong>节点组成</strong></p><ol><li>图片由众多节点组成，节点之间必然会分组聚合，这些同组节点的父节点一般是：GROUP(组节点)、BOOLEAN_OPERATION（一种逻辑节点）、FRAME（容器节点）。</li><li>在设计（绘制）图片时，只会使用 PEN_NODE（路径节点，即各种自由绘制的路径，如曲线）、基础图形（方形、圆形等）、BOOLEAN_OPERATION、其他绘图辅助节点</li></ol><p><strong>图形类型</strong></p><ul><li><p>简单图形</p><ul><li>仅使用 PEN_NODE 或基础图形绘制的</li><li>FRAME 或 RECTANGLE 等基础图形作为一个外框，实际的内容是使用一张图片填充进去的</li></ul></li><li><p>复合图形</p><ul><li>各种节点以 GROUP 等分组聚合，组和组之间嵌套</li></ul></li></ul><p>下面是一些实际的示例。</p><h3 id=单个-group-节点>单个 GROUP 节点</h3><p>根节点下只存在 PEN_NODE、基础图形、BOOLEAN_OPERATION 节点。</p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/%E5%8D%95%E4%B8%AAgroup%E6%A0%91.png alt=单个group树></p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/%E5%8D%95%E4%B8%AAgroup%E7%A4%BA%E4%BE%8B.png alt=单个group树示例></p><h3 id=group-嵌套-group>GROUP 嵌套 GROUP</h3><p><strong>GROUP 下含有文本节点和 GROUP 节点</strong></p><p>因为已经限定视觉切图是不含有文字的（国际化需要），所以这种情况，最外层的 GROUP 应该被取消认定为静态图片，内层 GROUP 取代认定。</p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/group%E4%B8%8B%E5%AD%98%E5%9C%A8%E6%96%87%E6%9C%AC.png alt=group下存在文本></p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/group%E4%B8%8B%E5%AD%98%E5%9C%A8%E6%96%87%E6%9C%AC%E7%A4%BA%E4%BE%8B.png alt=group下存在文本示例></p><p><strong>GROUP 节点嵌套，共同组合为一个图片</strong></p><p>多个 GROUP 组合为一张图，每个 GROUP 下只含有 PEN_NODE、基础图形、BOOLEAN_OPERATION 节点。</p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/group%E5%B5%8C%E5%A5%97.png alt=group下节点嵌套></p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/group%E5%B5%8C%E5%A5%97%E7%A4%BA%E4%BE%8B.png alt=group下节点嵌套示例></p><p><strong>GROUP 节点嵌套，含有多张图形</strong></p><p>GROUP 下有多个 GROUP 嵌套，每个 GROUP 各为一张图。</p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/group%E5%B5%8C%E5%A5%97%E5%A4%9A%E5%BC%A0%E5%9B%BE.png alt=group下多张图></p><p><img src=https://blog-1305900062.cos.ap-guangzhou.myqcloud.com/blog_pic/mastergo_static_image/group%E5%B5%8C%E5%A5%97%E5%A4%9A%E5%BC%A0%E5%9B%BE%E7%A4%BA%E4%BE%8B.png alt=group下多张图示例></p><h2 id=解决方案>解决方案</h2><p>通过归纳，可以判定一个静态图片从节点的组成上是有共性的：</p><ul><li>以 GROUP、BOOLEAN_OPERATION、FRAME 作为父（根）节点</li><li>子节点为 PEN_NODE、基础图形、BOOLEAN_OPERATION、GROUP 等节点</li></ul><p>从数据结构来说，整个设计稿可以抽象为一颗多叉树，所以判断设计稿中的静态图片，<strong>本质上可以抽象为从一颗树中寻找满足条件的所有子树</strong>。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>findStaticImgNode</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>node</span> =&gt; {
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>isVisible</span> <span style=color:#f92672>===</span> <span style=color:#66d9ef>false</span>) <span style=color:#66d9ef>return</span> [];
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>groupPossibleStaticImg</span>(<span style=color:#a6e22e>node</span>)) {
        <span style=color:#66d9ef>return</span> [{
            <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>id</span>,
            <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>name</span>,
        }];
    }

    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>collections</span> <span style=color:#f92672>=</span> [];
    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>childNode</span> <span style=color:#66d9ef>of</span> (<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>children</span> <span style=color:#f92672>||</span> [])) {
        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>[<span style=color:#e6db74>&#39;GROUP&#39;</span>, <span style=color:#e6db74>&#39;BOOLEAN_OPERATION&#39;</span>, <span style=color:#e6db74>&#39;FRAME&#39;</span>].<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>childNode</span>.<span style=color:#a6e22e>type</span>)) <span style=color:#66d9ef>continue</span>;

        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>res</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>findStaticImgNode</span>(<span style=color:#a6e22e>childNode</span>);
        <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>collections</span>.<span style=color:#a6e22e>push</span>(...<span style=color:#a6e22e>res</span>);
    }

    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>collections</span>;
};

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>groupPossibleStaticImg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>node</span> =&gt; {
    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>imgNodeAllowType</span>(<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>type</span>)) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
    <span style=color:#66d9ef>if</span> ([<span style=color:#e6db74>&#39;GROUP&#39;</span>, <span style=color:#e6db74>&#39;BOOLEAN_OPERATION&#39;</span>, <span style=color:#e6db74>&#39;PEN&#39;</span>, <span style=color:#e6db74>&#39;各种基础图形&#39;</span>].<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>type</span>)) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;

    <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>children</span> <span style=color:#f92672>||</span> []).<span style=color:#a6e22e>reduce</span>((<span style=color:#a6e22e>valid</span>, <span style=color:#a6e22e>curNode</span>) =&gt; {
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>valid</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>groupPossibleStaticImg</span>(<span style=color:#a6e22e>curNode</span>);
    }, <span style=color:#66d9ef>true</span>);
};
</code></pre></div><h4>Comments:</h4><div id=cusdis_thread data-host=https://cusdis.com data-app-id=a2f9224a-c294-4108-998e-c8818b5dec9e data-page-id=247df982b804d2839674642033dd9284 data-page-url=https://cocacolf.github.io/blog/%E8%A7%86%E8%A7%89%E7%A8%BF%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E5%9B%BE%E7%89%87%E8%AF%86%E5%88%AB/ data-page-title=视觉稿中的静态图片识别></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><footer><script src=//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/languages/javascript.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/languages/js.min.js></script><script>hljs.configure({languages:[]});hljs.initHighlightingOnLoad();</script><hr><div class=copyright>© CocaColf | <a href=https://github.com/CocaColf>Github</a></div></footer></article></body></html>